<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>明細</title>
    <style>
        /* 全体 */
        body {
            font-family: system-ui, -apple-system;
            background: #f5f5f5;
            margin: 0;
            padding: 16px;
        }

        /* タイトル */
        h1 {
            text-align: center;
            margin-bottom: 16px;
        }

        /* ===== フィルターエリア ===== */
        .filters {
            background: #ffffff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        /* フィルターのグループ */
        .filters>div {
            margin-bottom: 8px;
        }

        /* ボタン共通 */
        .filter-btn {
            margin: 4px 4px 4px 0;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background: #fff;
            color: #333;
            font-size: 14px;
            cursor: pointer;
        }

        /* ON状態（Excelスライサー風） */
        .filter-btn.active {
            background: #007aff;
            color: #fff;
            border-color: #007aff;
        }

        /* ===== テーブル ===== */
        table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
        }

        /* ヘッダー固定 */
        thead th {
            position: sticky;
            top: 0;
            background: #eeeeee;
            z-index: 1;
        }

        /* セル */
        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }

        /* 金額列右寄せ */
        td:nth-child(3) {
            text-align: right;
        }

        /* マイナス金額 */
        .negative {
            color: red;
            font-weight: bold;
        }

        /* 行ホバー */
        tbody tr:hover {
            background: #f0f8ff;
        }
    </style>
</head>

<body>
    <h1>明細</h1>

    <div class="filters">
        <!-- 月フィルター -->
        <div class="month-filters">
            {% for m in months %}
            <button class="filter-btn active" data-month="{{ m }}">
                {{ m }}
            </button>
            {% endfor %}
        </div>

        <!-- 口座フィルター -->
        <div class="account-filters">
            {% for name in account_names %}
            <button class="filter-btn active" data-account="{{ name }}">
                {{ name }}
            </button>
            {% endfor %}
        </div>

        <!-- 金額フィルター -->
        <div class="amount-filters">
            <button class="filter-btn active" data-amount="plus">収入</button>
            <button class="filter-btn active" data-amount="minus">支出</button>
        </div>
    </div>


    <table border="1" width="100%">
        <thead>
            <tr>
                <th>日付</th>
                <th>口座</th>
                <th>金額</th>
                <th>メモ</th>
            </tr>
        </thead>
        <tbody>
            {% for d in details %}
            <tr class="detail-row"
                data-account="{{ d['account_name'] }}" 
                data-amount="{{ d['amount'] }}"
                data-month="{{ d['saved_date'][:7] }}">
                <td>{{ d['saved_date'] }}</td>
                <td>{{ d['account_name'] }}</td>
                <td class="{% if d['amount'] < 0 %}negative{% endif %}">
                    {{ "{:,}".format(d['amount']) }}
                </td>
                <td>{{ d['memo'] }}</td>
            </tr>
            {% endfor %}
        </tbody>

    </table>

    <script>
        const buttons = document.querySelectorAll(".filter-btn");

        buttons.forEach(btn => {
            btn.addEventListener("click", () => {
                btn.classList.toggle("active");

                // 全OFF防止（最低1つはON）
                const group = btn.parentElement;
                const activeCount = group.querySelectorAll(".active").length;
                if (activeCount === 0) {
                    btn.classList.add("active");
                    return;
                }

                applyFilters();
            });
        });

        function applyFilters() {
            const activeAccounts = [...document.querySelectorAll(
                ".account-filters .active"
            )].map(b => b.dataset.account);

            const activeMonths = [...document.querySelectorAll(
                ".month-filters .active"
            )].map(b => b.dataset.month);

            const activeAmounts = [...document.querySelectorAll(
                ".amount-filters .active"
            )].map(b => b.dataset.amount);

            document.querySelectorAll(".detail-row").forEach(row => {
                const account = row.dataset.account;
                const month = row.dataset.month;
                const amount = Number(row.dataset.amount);

                const accountOK = activeAccounts.includes(account);
                const monthOK = activeMonths.includes(month);
                const amountOK =
                    (amount > 0 && activeAmounts.includes("plus")) ||
                    (amount < 0 && activeAmounts.includes("minus"));

                row.style.display =
                    accountOK && monthOK && amountOK ? "" : "none";
            });
        }
    </script>

    `




</body>

</html>